# Техническое задание  
# на разработку веб-мобильного приложения  
# «Аудио-навигация для незрячих людей в закрытых пространствах»

## 1. Назначение и область применения

Цель разработки — создать веб-мобильное приложение на Flutter/Dart с аудиодвижком Csound (WebAssembly) для безопасной навигации незрячих пользователей внутри закрытых помещений. Приложение обеспечивает ориентирование на выбранный объект назначения по наводящему звуку, параметры которого изменяются при приближении и изменении направления, а также озвучивание препятствий отдельными сигналами. Система рассчитана на здания общественного пользования, где существует фиксированный перечень объектов, доступных для выбора пользователем. В текущей итерации позиционирование может поступать из внешнего источника или имитироваться; аудиологика полностью реализуется на фронтенде.

## 2. Основания, версии и совместимость

Требуется перейти на актуальную веб-поставку Csound, где устаревший фронтенд csound.js не используется, а интеграция выполняется через NPM-модули и ESM-импорты. Целевые минимальные версии инструментов: Dart SDK 3.4.3 или новее, Flutter 3.22.2 или новее, Csound версии 6.18.1 (предпочтительно) при допустимом нижнем пороге 6.16.0. Целевая среда браузера — Google Chrome для Android версии 138 и выше; приветствуется тестирование в актуальных Safari на iOS. Версия JavaScript — ECMAScript 2020 в модульном режиме ESM и строгом режиме выполнения. Для разработки и локального тестирования рекомендуется Node.js LTS версии 18, при минимально допустимой версии 16.14. В рамках данной итерации поддержка iOS ведётся на уровне веб-сборки; нативная интеграция библиотеки csounddart для iOS за пределами веб не требуется и может быть рассмотрена в перспективе.

## 3. Ограничения и допущения

В проекте отсутствует хранение персональных данных пользователя; ведётся лишь техническое логирование событий сеанса. Позиционирование и карта помещения предоставляются внешним модулем или имитатором, интерфейс обмена стандартизируется. Приложение запускается в мобильных браузерах без установки нативных компонентов; допускается отладка в настольных браузерах. В случае включения SharedArrayBuffer для повышения производительности применяются безопасные заголовки изоляции в среде хостинга. Сеть используется только для загрузки статических ресурсов и, при необходимости, для записи логов в удалённый бэкенд; аудиопотоки не отправляются на сервер.

## 4. Архитектура решения

Архитектура фронтенда разделена на уровни. На уровне загрузки веб-страницы используется стандартный index.html Flutter Web, который инициирует импорт модулей через ESM. На этапе инициализации аудио создаётся экземпляр Csound в браузере с использованием WebAssembly и Web Audio API, стартует аудиодвижок, подготавливаются каналы управления. На уровне мостика между Dart и JavaScript экспортируется объект window.csoundAPI с методами управления; вызовы выполняются из Flutter через dart:js и package:js_util. На уровне логики навигации модуль «Провайдер позиции и карты» реализует контракт получения координат пользователя и целей и расчёт нормализованных величин расстояния и угла; эти величины транслируются в каналы Csound. На уровне пользовательского интерфейса реализуется минималистичный набор экранов и озвученных состояний, совместимых с технологией экранного доступа. На уровне хранения реализуется локальная база для логов (IndexedDB) либо подключение к удалённому хранилищу (например, Firestore) по HTTPS.

## 5. Минимальный интерфейс и сценарии взаимодействия

Интерфейс предельно простой и доступный. На первом экране отображается крупная кнопка «Старт», активирующая инициализацию Csound . После инициализации становится доступна кнопка «Тест» для воспроизведения эталонного звука, по которому можно убедиться в корректности работы аудио. Далее пользователь переходит к экрану выбора цели: элементы выбора представлены крупными интерактивными зонами с озвучиванием фокуса; набор целей ограничен разумным перечнем. После подтверждения выбора запускается режим навигации: воспроизводится наводящий звук, меняющий громкость и панораму при изменении расстояния и угла к цели; при приближении к препятствиям звучит отдельный краткий сигнал. С любого экрана пользователь может вернуться к состоянию «Стоп», завершив аудио-сессию и освобождая ресурсы.

## 6. Функциональные требования

Приложение должно корректно инициализировать Csound, готовить каналы управления и обеспечивать запуск тестового сценария. Оно должно принимать параметры навигации от «Провайдера позиции и карты», вычислять целевые аудиопараметры и передавать их в аудиодвижок без заметной задержки. Оно обязано озвучивать препятствия отдельным узнаваемым сигналом, отличным от наводящего. Оно должно вести журнал технических событий, включая начало и конец сеанса, выбор цели, обновления параметров и срабатывания предупреждений. Оно обязано сопровождать критические состояния голосовыми подсказками и корректно завершать работу аудиодвижка.

## 7. Нефункциональные требования

Требуется обеспечивать время «холодного» старта до готовности аудио не более трёх секунд и время повторной инициализации в пределах двух секунд. Задержка реакции от получения новых координат до слышимого обновления звука не должна превышать двухсот миллисекунд. Использование оперативной памяти браузера при активной навигации не должно превышать двухсот мегабайт. Стабильность звука должна исключать клиппирование и щелчки при штатной нагрузке. Потребление батареи минимизируется за счёт паузы аудиопотока при длительной неподвижности пользователя и пониженной частоты обновления параметров в режиме ожидания.

## 8. Требования к доступности

Интерфейс должен соответствовать принципам доступности уровня не ниже WCAG 2.1 AA, включая корректное объявление элементов для экранных дикторов, предсказуемый порядок фокуса, озвучивание состояний, достаточный контраст и большие зоны касания. Управление должно поддерживать жесты доступности, такие как двойное касание для активации и свайпы для перемещения между элементами. Текстовые элементы дублируются голосовыми подсказками; все критические ошибки и завершение сеанса сопровождаются речевыми уведомлениями.

## 9. Модель данных и журналирование

Журнал событий реализуется локально или в облачном хранилище. Запись включает отметку времени, тип события, параметры аудио в момент события и служебные идентификаторы сессии. Персональные данные пользователя не сохраняются. При использовании удалённой БД запросы выполняются по HTTPS; в случае недоступности сети логи буферизуются локально и отправляются при восстановлении соединения. Формат записей стабилизируется и документируется для последующего анализа.

## 10. Аудио-алгоритмы и параметры сигналов

Наводящий сигнал представляет собой устойчивую узкополосную генерацию, пригодную для длительного прослушивания. Рекомендуется синусоидальный тон базовой частоты в районе 700–900 Гц с модуляцией амплитуды, зависящей от обратного расстояния, и панорамированием, зависящим от угла направления на цель. Уровень ограничивается ниже 0 dBFS, с мягким лимитированием на пиках. Для дополнительной модальности допускается лёгкая частотная модуляция при малом удалении от цели. Сигнал препятствия — короткий звук с высокой частотой, отчётливо отличимый от наводящего, воспроизводимый однократно при входе в критическую зону и повторяемый с разумной частотой при продолжении сближения. Все параметры, включая усиление, панораму, флаги активности движения и предупреждений, передаются через каналы Csound и изменяются в реальном времени.

## 11. Интеграция Csound в веб-окружение

Интеграция выполняется через NPM-пакеты с модульной загрузкой. В index.html включается модульный скрипт, который импортирует загрузчик аудиодвижка. В загрузчике создаётся экземпляр Csound, запускается аудио и экспортируются функции управления в window.csoundAPI. В Flutter Web реализация опирается на package:js для вызова методов из Dart. Для тестов предусматриваются два пути: компиляция и запуск CSD-текста, встроенного строкой, и проигрывание подготовленного аудиофайла через соответствующий инструмент Csound. При необходимости применяется SharedArrayBuffer и рабочие потоки для аудио, при этом корректно настраиваются заголовки безопасности в среде хостинга.

## 12. Контракт «Провайдер позиции и карты»

Контракт определяет три функции: выдачу статической топологии помещения, выдачу текущих координат пользователя с частотой не ниже двух герц и выдачу списка доступных целей с их координатами и метаданными. На вход аудиологики подаются координаты пользователя и цели; на выходе формируются нормализованные величины расстояния и угла, пригодные для прямой передачи в каналы Csound. Для имитации предусмотрен встроенный генератор траекторий с управлением скоростью и топологией простых препятствий. Формат координат указывается в декартовой системе измерений помещения; единицы измерения оговариваются для согласования порогов срабатывания предупреждений.

## 13. Безопасность и конфиденциальность

Приложение работает по HTTPS; сторонние скрипты и ресурсы происходят из доверенных источников. Не ведётся запись аудио с микрофона и не осуществляется передача голоса во внешние API. Конфигурация зависимостей фиксируется в файлах манифестов, обновление пакетов выполняется контролируемо и сопровождается аудитом уязвимостей. Секреты доступа и ключи не хранятся в клиентском коде; при необходимости удалённого логирования используются анонимные маркеры сессии.

## 14. Сборка, развёртывание и эксплуатация

Сборка выполняется стандартными командами Flutter Web. Каталог сборки развёртывается на веб-сервере, поддерживающем раздачу ESM и корректные заголовки для WASM. В производственной среде настраиваются политики изоляции для использования общих буферов при многопоточности аудио. Обновление версии Csound производится синхронно с обновлением зависимостей; хранится файл блокировок для воспроизводимости сборок. В эксплуатационной документации фиксируются все номера версий, инструкции по локальному запуску на Android и iOS, набор известных ограничений и способ эскалации инцидентов.

## 15. План миграции на новую схему Csound

Миграция начинается с исключения устаревшего csound.js из цепочки загрузки. Далее добавляются зависимости NPM и ESM-импорт, создаётся модуль загрузчика, экспортирующий унифицированный интерфейс управления. В коде Flutter выполняется замена прямых вызовов на обращения к window.csoundAPI. Затем проводятся «дымовые» тесты: проверка инициализации, воспроизведения эталонного звука и компиляции простого CSD-сценария. После успешной проверки переносится прикладная аудиологика навигации, и выполняются тесты на мобильных устройствах. Итогом этапа является фиксация версий и обновление документации.

## 16. Тестирование и критерии приёмки

Базовый сценарий тестирования включает открытие приложения, инициализацию Csound . Нажатие «Тест» должно воспроизвести эталонный звук без артефактов. Выбор цели запускает непрерывный наводящий сигнал, параметры которого воспроизводимо меняются при модификации координат. Имитатор препятствий должен вызывать предупреждающий сигнал при входе в критическую зону. Логи обязаны фиксировать все события в заданном формате. Приёмка считается успешной при выполнении временных нормативов старта и отклика, отсутствии аудиоартефактов в эталонных сценариях и корректной работе интерфейса доступности на Android и iOS.

## 17. Итоговые артефакты

Результатом являются исходные коды Flutter/Dart и JavaScript-мост, CSD-материалы для генерации звука, схемы интерфейсов и документация по сборке и развёртыванию, а также тестовые отчёты с подтверждением соответствия требованиям. Приложение предоставляет минимальный, воспроизводимый и расширяемый фундамент аудио-навигации для незрячих пользователей, готовый к дальнейшему расширению функциональности и подключению внешних систем позиционирования.
 