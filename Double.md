# Тип данных `Double` в Swift

Тип `Double` в языке Swift представляет собой число с плавающей запятой двойной точности. Он соответствует формату *binary64* стандарта IEEE 754 и используется по умолчанию при создании литералов с десятичной точкой. Например, запись `let x = 3.14` без уточнения типа будет интерпретирована как `Double`. Такой выбор языка связан с тем, что `Double` обеспечивает высокую точность и широкий диапазон значений, что делает его подходящим для большинства вычислений.

## Историческая и математическая основа

Числа с плавающей запятой в Swift реализованы в строгом соответствии со стандартом IEEE 754. Этот стандарт определяет правила хранения, округления и работы с такими числами. Для `Double` выделяется 64 бита: 1 бит для знака, 11 бит для показателя степени и 52 бита для мантиссы, в которую также включается неявная старшая единица у нормализованных чисел. Такое устройство позволяет хранить примерно 15–17 значащих десятичных цифр и оперировать значениями в огромном диапазоне — от порядка 10⁻³⁰⁸ до порядка 10³⁰⁸.

## Роль в системе типов Swift

Тип `Double` встроен в стандартную библиотеку Swift и реализует широкий набор протоколов. Ключевым является `BinaryFloatingPoint`, который определяет поведение чисел с плавающей точкой в двоичном формате и предоставляет базовые операции: арифметику, сравнение, вычисление округлений и работу с ULP (единицей последнего разряда). Через этот протокол `Double` также реализует интерфейсы `FloatingPoint`, `Numeric`, `SignedNumeric`, `AdditiveArithmetic` и `Strideable`. Благодаря этому тип можно использовать в арифметических выражениях, в последовательностях с шагом, а также сравнивать и кодировать в формате JSON или Plist. Кроме того, `Double` поддерживает протокол `ExpressibleByFloatLiteral`, что делает возможным использование обычных литералов с точкой в исходном коде.

## Инициализация и литералы

Создать значение `Double` можно множеством способов. Самый очевидный — использовать литерал с плавающей точкой, например `2.5`. Swift автоматически выводит тип как `Double`. Можно явно указать тип, написав `2.5 as Double` или `let value: Double = 2.5`. Дополнительно доступны инициализаторы от строк, например `Double("3.14")`, возвращающий опционал, и от целых чисел, как безопасных, так и требующих проверки на переполнение. Существует и преобразование из `Float` в `Double`, которое всегда возможно без потери значимости, так как `Double` хранит больше бит мантиссы.

## Числовые границы и особые значения

Тип `Double` предоставляет набор статических свойств, которые описывают его границы и специальные состояния. Наибольшее конечное значение хранится в `Double.greatestFiniteMagnitude`, а минимальные положительные значения представлены как `Double.leastNormalMagnitude` (минимальное нормальное число) и `Double.leastNonzeroMagnitude` (минимальное ненулевое, включая субнормалы). Кроме того, в API присутствуют специальные значения: `Double.infinity`, `-Double.infinity` и `Double.nan`. Последнее обозначает «не число» и всегда ведёт себя особым образом — в частности, любое сравнение с `nan` возвращает `false`.

## Точность и шаг представления

Для анализа точности вычислений в Swift доступно свойство `ulp`. Оно показывает минимальную разницу между данным числом и следующим представимым значением. Для числа 1.0 соответствующий шаг равен `Double.ulpOfOne`. Также существуют методы `nextUp` и `nextDown`, позволяющие получить ближайшее большее или меньшее представимое число. Эти механизмы необходимы для точного контроля вычислений и особенно важны при реализации алгоритмов, где критично учитывать ошибки округления.

## Округление и остатки

Swift предоставляет гибкие средства округления значений `Double`. Метод `rounded(_:)` возвращает округлённое значение по указанному правилу, а метод `round(_:)` изменяет переменную на месте. Доступны все правила из стандарта IEEE 754, включая «к ближайшему, к чётному», «вверх», «вниз» и «к нулю». Помимо округления реализованы разные варианты вычисления остатков. Метод `remainder(dividingBy:)` использует стандартное определение IEEE и может возвращать отрицательные значения, тогда как метод `truncatingRemainder(dividingBy:)` работает по принципу усечения частного к нулю, аналогично функции `fmod` в C.

## Корень и операции FMA

Вычисление квадратного корня выполняется через метод `squareRoot()`, а его вариант `formSquareRoot()` изменяет значение на месте. Для повышения точности сложных выражений предусмотрены методы `addProduct` и `addingProduct`, реализующие так называемое умножение с накоплением (fused multiply-add). Они выполняют вычисление `a * b + c` с одним актом округления, что повышает численную устойчивость.

## Классификация и работа со знаками

Тип `Double` позволяет определять свойства числа через булевы флаги: `isFinite`, `isInfinite`, `isNaN`, `isNormal`, `isSubnormal`, `isZero` и `isSignMinus`. Эти свойства необходимы для правильной обработки особых случаев, таких как отрицательный ноль (`-0.0`), который равен положительному нулю в обычном сравнении, но имеет установленный знак.

## Сравнение и точность вычислений

Сравнение чисел с плавающей запятой требует осторожности. Например, выражение `0.1 + 0.2 == 0.3` возвращает `false` из-за особенностей двоичного представления дробей. Для практических задач рекомендуется использовать либо сравнение по модулю разности с определённым порогом, либо проверку на количество различий в ULP. При этом необходимо помнить, что `NaN` никогда не равен никакому числу, включая самого себя.

## Использование в шагах и диапазонах

Благодаря соответствию протоколу `Strideable`, значения типа `Double` можно использовать в последовательностях с шагом. Функции `stride(from:to:by:)` и `stride(from:through:by:)` позволяют удобно проходить диапазон вещественных чисел. Это часто применяется при построении дискретных сеток и численных экспериментов.

## Практические рекомендации

Swift делает выбор в пользу `Double` как типа по умолчанию, потому что на 64-битных устройствах он обеспечивает хорошее соотношение производительности и точности. Использовать `Float` целесообразно только тогда, когда важна экономия памяти и достаточно меньшей точности. Для финансовых приложений лучше применять тип `Decimal`, который основан на десятичной системе и не страдает от двоичных артефактов вроде бесконечного представления числа 0.1.

## Заключение

`Double` — это ключевой тип данных для работы с вещественными числами в Swift. Он сочетает высокую точность, широкие возможности работы с округлением и особыми значениями, а также глубокую интеграцию со стандартной библиотекой через протоколы. Благодаря своей универсальности и удобству, именно `Double` рекомендуется использовать для большинства задач, связанных с вещественными числами, если только специфика области не требует других решений.